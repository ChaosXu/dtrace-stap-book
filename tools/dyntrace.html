<html>
<head>
	<meta charset="utf-8" /> 
	<meta http-equiv="Content-Type" content="text/html">
	<meta name="generator" content="TSDoc 0.2">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<title>Module 1: Dynamic tracing tools. dtrace and stap tools</title>
	
	<link rel="stylesheet" href="../bootstrap/css/bootstrap.css" />
	<link href="../bootstrap/css/bootstrap-responsive.css" rel="stylesheet" media="screen,handheld"/>
	
	<script type="text/javascript">
	function toggleCode(id) {
		code = document.getElementById(id);
		hideClass = 'hide';
		
		if(code.classList.contains(hideClass))
			code.classList.remove(hideClass);
		else
			code.classList.add(hideClass);
	}
	</script>
</head>
<body>

<!-- HEADER -->

<div class="navbar">
    <div class="navbar-inner">
	    <div class="container">
			<a class="brand" href="../index.html">Dynamic Tracing with DTrace & SystemTap</a><ul class="nav pull-left">
<li><a href="tracing.html"><strong>Prev</strong>(Tracing)</a></li>
</ul>
<ul class="nav pull-right">
<li><a href="dtrace.html"><strong>Next</strong>(DTrace)</a></li>
</ul>
		</div>
    </div>
</div>

<div class="container max-height no-overflow">
	<div id="content" nevow:render="content">
		<p>
<h3>Dynamic tracing</h3></p>
<p>
Unlike other approaches, dynamic tracing tool embeds tracing code into working user program or kernel, without need of recompilation or reboot. Since any processor instruction may be patched, it can virtually access any information you need at any place. <br /></p>
<p>
Solaris DTrace development was begun in 1999, and it became part of Solaris 10 release. Along with other revolutionary Solaris 10 features, it shaken world of operating systems, and still evolve. You may found more information about DTrace history here: <a href="https://blogs.oracle.com/bmc/entry/happy_5th_birthday_dtrace">Happy 5th Birthday, DTrace!</a>.<br /></p>
<p>
Here are some DTrace information sources:<br />     <ul>
        <li>
<a href="https://wikis.oracle.com/display/DTrace/DTrace">Oracle Wiki</a></li>
        <li>
<a href="http://www.solarisinternals.com/wiki/index.php/DTrace_Topics">DTrace at SolarisInternals wiki</a></li>
        <li>
 «Solaris Performance and Tools» book<br /> </li>
        <li>
 «DTrace - Dynamic Tracing in Oracle Solaris, Mac OS X and FreeBSD» book<br /> </li>
        <li>
<a href="http://download.oracle.com/docs/cd/E19253-01/817-6223/">Solaris Dynamic Tracing Guide</a></li>
</ul>
</p>
<p>
During course we will refer to <em>Solaris Dynamic Tracing Guide</em> with the following sign: <img src="../images/icons/dtrace.png" alt=" with the following sign: " class="img-rounded"/></p>
<p>
DTrace was open-sourced as a part of OpenSolaris, but due to license incompatibility, it can't be merged with Linux Kernel. Several ports existed, but they lacked of proper support. The only stable port is provided in Unbreakable Enterprise Kernel by Oracle for their own Linux distribution which is not wide-spread. There were attempt to develop another clone of DTrace -- DProbes, but it was a failure. Over time three major Linux players: Red Hat, Hitachi, IBM presented dynamic tracing system for Linux called <a href="http://sourceware.org/systemtap/">SystemTap</a>. It has two primary sources of information: <a href="http://sourceware.org/systemtap/langref/">SystemTap Language Reference</a> to which we will reference with icon <img src="../images/icons/staplang.png" alt=" to which we will reference with icon " class="img-rounded"/><a href="http://sourceware.org/systemtap/tapsets/">SystemTap Tapset Reference Manual</a> to which we will reference with icon <img src="../images/icons/stapset.png" alt=" to which we will reference with icon " class="img-rounded"/>. Of course, there is a Unix manual pages, to which we will refer with icon <img src="../images/icons/manpage.png" alt=". Of course, there is a Unix manual pages, to which we will refer with icon " class="img-rounded"/>. <br /></p>
<p>
SystemTap has to generate native module for each script it runs, which is huge performance penalty, so as alternative to it, <a href="https://github.com/ktap/ktap">Ktap</a> is developing. Its language syntax shares some features with SystemTap, but it uses Lua and LuaJIT internally which makes it faster than SystemTap. Modern kernel versions has eBPF integrated, and there is experiment on using it as a platform for generating probe code, but it is far from final stage as of kernel version 4.1. Finally, there is a <a href="http://www.sysdig.org/">sysdig</a> which is scriptless. <br /></p>
<p>
As name of the book states, it describes SystemTap and DTrace.<br /></p>
<p>
<img src="../images/dyntrace.png" alt="" class="img-rounded"/></p>
<p>
Dynamic tracing system logic is quite simple: you create a script in C-like language which is translated to a probe code by a <em>compiler</em>. DTrace scripts are written in D (do not disambiguate with D language from digital mars) have extension <code>.d</code>, while SystemTap scripts have extension <code>.stp</code> and written in SystemTap Language (it doesn't have special name). That <em>probe code</em> is loaded into kernel address space by a kernel module and patches current binary code of kernel. Probes are writing collected data to intermediate <em>buffers</em> that are usually lock-free, so they have small effect on kernels performance and doesn't need to switch context to a tracing program. Separate entity called <em>consumer</em> reads that buffers and writes gathered data into terminal, pipe or to a file.</p>

	</div>
</div>

<!-- TAIL -->

<div class="navbar navbar-bottom">
    <div class="navbar-inner">
        <div class="container">
            <ul class="nav pull-left">
<li><a href="tracing.html"><strong>Prev</strong>(Tracing)</a></li>
</ul>
<ul class="nav pull-center">
<li><a href="../index.html"><strong>Up</strong>(Dynamic Tracing with DTrace & SystemTap)</a></li>
</ul>
<ul class="nav pull-right">
<li><a href="dtrace.html"><strong>Next</strong>(DTrace)</a></li>
</ul>
        </div>
    </div>
</div>

<ul class="breadcrumb">
    <li><a href="https://github.com/myaut/dtrace-stap-book"><small>GitHub</small></a> <span class="divider">|</span></li>
    <li><a href="https://bitbucket.org/sergey_klyaus/dtrace-stap-book"><small>BitBucket</small></a> <span class="divider">|</span></li>
    <li style="float: right; ">
        <small>
        Published under terms of <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">CC-BY-NC-SA 3.0</a> license.
        </small>
    </li>
</ul>
</body>
</html>